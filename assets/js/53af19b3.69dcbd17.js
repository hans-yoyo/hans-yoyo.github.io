"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[171],{3905:(n,e,t)=>{t.d(e,{Zo:()=>p,kt:()=>m});var a=t(7294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function E(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function l(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?E(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function s(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},E=Object.keys(n);for(a=0;a<E.length;a++)t=E[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(n);for(a=0;a<E.length;a++)t=E[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var i=a.createContext({}),o=function(n){var e=a.useContext(i),t=e;return n&&(t="function"==typeof n?n(e):l(l({},e),n)),t},p=function(n){var e=o(n.components);return a.createElement(i.Provider,{value:e},n.children)},N={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},T=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,E=n.originalType,i=n.parentName,p=s(n,["components","mdxType","originalType","parentName"]),T=o(t),m=r,c=T["".concat(i,".").concat(m)]||T[m]||N[m]||E;return t?a.createElement(c,l(l({ref:e},p),{},{components:t})):a.createElement(c,l({ref:e},p))}));function m(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var E=t.length,l=new Array(E);l[0]=T;var s={};for(var i in e)hasOwnProperty.call(e,i)&&(s[i]=e[i]);s.originalType=n,s.mdxType="string"==typeof n?n:r,l[1]=s;for(var o=2;o<E;o++)l[o]=t[o];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}T.displayName="MDXCreateElement"},3467:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>l,default:()=>N,frontMatter:()=>E,metadata:()=>s,toc:()=>o});var a=t(7462),r=(t(7294),t(3905));const E={},l=void 0,s={unversionedId:"mysql/MySQL\u547d\u4ee4(\u64cd\u4f5c)",id:"mysql/MySQL\u547d\u4ee4(\u64cd\u4f5c)",title:"MySQL\u547d\u4ee4(\u64cd\u4f5c)",description:"\u5b98\u65b9\u6587\u6863\uff1ahttps://dev.mysql.com/doc/refman/5.7/en/sql-statements.html",source:"@site/wiki/database/mysql/MySQL\u547d\u4ee4(\u64cd\u4f5c).md",sourceDirName:"mysql",slug:"/mysql/MySQL\u547d\u4ee4(\u64cd\u4f5c)",permalink:"/wiki/database/mysql/MySQL\u547d\u4ee4(\u64cd\u4f5c)",draft:!1,tags:[],version:"current",lastUpdatedBy:"hyman213",lastUpdatedAt:1677503089,formattedLastUpdatedAt:"2023\u5e742\u670827\u65e5",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"MySQL\u5206\u533a\u8868",permalink:"/wiki/database/mysql/MySQL\u5206\u533a\u8868"},next:{title:"MySQL\u547d\u4ee4(\u7ba1\u7406)",permalink:"/wiki/database/mysql/MySQL\u547d\u4ee4(\u7ba1\u7406)"}},i={},o=[{value:"FQA",id:"fqa",level:2},{value:"\u64cd\u4f5c\u7bc7",id:"\u64cd\u4f5c\u7bc7",level:2},{value:"\u6570\u636e\u5e93",id:"\u6570\u636e\u5e93",level:3},{value:"\u6570\u636e\u8868",id:"\u6570\u636e\u8868",level:3},{value:"\u8868\u5b57\u6bb5",id:"\u8868\u5b57\u6bb5",level:3},{value:"\u67e5\u8be2",id:"\u67e5\u8be2",level:3},{value:"@ rownum\u67e5\u8be2\u8bb0\u5f55\u5728\u5f53\u524d\u7ed3\u679c\u96c6\u7684\u884c\u53f7",id:"-rownum\u67e5\u8be2\u8bb0\u5f55\u5728\u5f53\u524d\u7ed3\u679c\u96c6\u7684\u884c\u53f7",level:3},{value:"\u8868\u6570\u636e",id:"\u8868\u6570\u636e",level:3},{value:"\u7d22\u5f15\u3001\u4e3b\u952e\u3001\u5916\u952e",id:"\u7d22\u5f15\u4e3b\u952e\u5916\u952e",level:3},{value:"\u51fd\u6570\u3001\u5b58\u50a8\u8fc7\u7a0b",id:"\u51fd\u6570\u5b58\u50a8\u8fc7\u7a0b",level:3},{value:"\u89e6\u53d1\u5668\u3001\u89c6\u56fe\u3001\u5b9a\u65f6\u4efb\u52a1",id:"\u89e6\u53d1\u5668\u89c6\u56fe\u5b9a\u65f6\u4efb\u52a1",level:3},{value:"\u67e5\u8be2MySQL\u914d\u7f6e",id:"\u67e5\u8be2mysql\u914d\u7f6e",level:3},{value:"\u6570\u636e\u5e93\u5b57\u7b26\u96c6",id:"\u6570\u636e\u5e93\u5b57\u7b26\u96c6",level:4}],p={toc:o};function N(n){let{components:e,...t}=n;return(0,r.kt)("wrapper",(0,a.Z)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u5b98\u65b9\u6587\u6863\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/sql-statements.html"},"https://dev.mysql.com/doc/refman/5.7/en/sql-statements.html")),(0,r.kt)("h2",{id:"fqa"},"FQA"),(0,r.kt)("p",null,"1\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"count(1)\u3001count(*)\u3001count(\u5217\u540d)")," \u7684\u533a\u522b"),(0,r.kt)("p",null,"\u6267\u884c\u7ed3\u679c\u4e0a\uff0c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"count(1)"),"\u3001",(0,r.kt)("inlineCode",{parentName:"li"},"count(*)")," \u4f1a\u7edf\u8ba1\u8868\u4e2d\u7684\u6240\u6709\u7684\u8bb0\u5f55\u6570\uff0c\u5305\u542b\u5b57\u6bb5\u4e3anull \u7684\u8bb0\u5f55\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"count(\u5217\u540d)")," \u4f1a\u7edf\u8ba1\u8be5\u5b57\u6bb5\u5728\u8868\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5ffd\u7565\u5b57\u6bb5\u4e3anull \u7684\u60c5\u51b5\u3002\u5373\u4e0d\u7edf\u8ba1\u5b57\u6bb5\u4e3anull \u7684\u8bb0\u5f55\u3002")),(0,r.kt)("p",null,"\u6267\u884c\u6548\u7387\u4e0a\uff0c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5217\u540d\u4e3a\u4e3b\u952e\uff0ccount(\u5217\u540d)\u4f1a\u6bd4count(1)\u5feb"),(0,r.kt)("li",{parentName:"ul"},"\u5217\u540d\u4e0d\u4e3a\u4e3b\u952e\uff0ccount(1)\u4f1a\u6bd4count(\u5217\u540d)\u5feb"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u6709\u4e3b\u952e\uff0c\u5219 select count\uff08\u4e3b\u952e\uff09\u7684\u6267\u884c\u6548\u7387\u662f\u6700\u4f18\u7684"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u8868\u53ea\u6709\u4e00\u4e2a\u5b57\u6bb5\uff0c\u5219 ",(0,r.kt)("inlineCode",{parentName:"li"},"count\uff08*\uff09"),"\u6700\u4f18")),(0,r.kt)("h2",{id:"\u64cd\u4f5c\u7bc7"},"\u64cd\u4f5c\u7bc7"),(0,r.kt)("h3",{id:"\u6570\u636e\u5e93"},"\u6570\u636e\u5e93"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"\n-- \u67e5\u770b\u5f53\u524d\u6570\u636e\u5e93\nSELECT DATABASE();\n-- \u663e\u793a\u5f53\u524d\u65f6\u95f4\u3001\u7528\u6237\u540d\u3001\u6570\u636e\u5e93\u7248\u672c\nSELECT now(), user(), version();\n-- \u521b\u5efa\u5e93\nCREATE DATABASE[ IF NOT EXISTS] \u6570\u636e\u5e93\u540d \u6570\u636e\u5e93\u9009\u9879\n    \u6570\u636e\u5e93\u9009\u9879\uff1a\n        CHARACTER SET charset_name\n        COLLATE collation_name\n-- \u67e5\u770b\u5f53\u524d\u5e93\u4fe1\u606f\nSHOW CREATE DATABASE \u6570\u636e\u5e93\u540d\n-- \u4fee\u6539\u5e93\u7684\u9009\u9879\u4fe1\u606f\nALTER DATABASE \u5e93\u540d \u9009\u9879\u4fe1\u606f\n-- \u5220\u9664\u5e93\nDROP DATABASE[ IF EXISTS] \u6570\u636e\u5e93\u540d\n        \u540c\u65f6\u5220\u9664\u8be5\u6570\u636e\u5e93\u76f8\u5173\u7684\u76ee\u5f55\u53ca\u5176\u76ee\u5f55\u5185\u5bb9\n\n\nCREATE DATABASE mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n--\u6ce8\u610f\u4f7f\u7528utf8mb4\u7f16\u7801\n\n-- \u4fee\u6539\u6570\u636e\u540d\uff1ahttps://cloud.tencent.com/developer/article/1835790\n\n")),(0,r.kt)("h3",{id:"\u6570\u636e\u8868"},"\u6570\u636e\u8868"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa\u8868")),(0,r.kt)("p",null,"\u521b\u5efa\u5206\u533a\u8868: [","[MySQL\u5206\u533a\u8868]","]"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efa\u8868\nCREATE [TEMPORARY] TABLE[ IF NOT EXISTS] [\u5e93\u540d.]\u8868\u540d ( \u8868\u7684\u7ed3\u6784\u5b9a\u4e49 )[ \u8868\u9009\u9879]\n\n-- \u5bf9\u4e8e\u5b57\u6bb5\u7684\u5b9a\u4e49\uff1a\n    \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT] [UNIQUE [KEY] | [PRIMARY] KEY] [COMMENT 'string']\n            \n-- \u8868\u9009\u9879\n    -- \u5b57\u7b26\u96c6\n    CHARSET = charset_name\n    \u5982\u679c\u8868\u6ca1\u6709\u8bbe\u5b9a\uff0c\u5219\u4f7f\u7528\u6570\u636e\u5e93\u5b57\u7b26\u96c6\n    -- \u5b58\u50a8\u5f15\u64ce\n    ENGINE = engine_name\n    \u8868\u5728\u7ba1\u7406\u6570\u636e\u65f6\u91c7\u7528\u7684\u4e0d\u540c\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7ed3\u6784\u4e0d\u540c\u4f1a\u5bfc\u81f4\u5904\u7406\u65b9\u5f0f\u3001\u63d0\u4f9b\u7684\u7279\u6027\u64cd\u4f5c\u7b49\u4e0d\u540c\n    \u5e38\u89c1\u7684\u5f15\u64ce\uff1aInnoDB MyISAM Memory/Heap BDB Merge Example CSV MaxDB Archive\n    \u4e0d\u540c\u7684\u5f15\u64ce\u5728\u4fdd\u5b58\u8868\u7684\u7ed3\u6784\u548c\u6570\u636e\u65f6\u91c7\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\n    MyISAM\u8868\u6587\u4ef6\u542b\u4e49\uff1a.frm\u8868\u5b9a\u4e49\uff0c.MYD\u8868\u6570\u636e\uff0c.MYI\u8868\u7d22\u5f15\n    InnoDB\u8868\u6587\u4ef6\u542b\u4e49\uff1a.frm\u8868\u5b9a\u4e49\uff0c\u8868\u7a7a\u95f4\u6570\u636e\u548c\u65e5\u5fd7\u6587\u4ef6\n    SHOW ENGINES -- \u663e\u793a\u5b58\u50a8\u5f15\u64ce\u7684\u72b6\u6001\u4fe1\u606f\n    SHOW ENGINE \u5f15\u64ce\u540d {LOGS|STATUS} -- \u663e\u793a\u5b58\u50a8\u5f15\u64ce\u7684\u65e5\u5fd7\u6216\u72b6\u6001\u4fe1\u606f\n    -- \u81ea\u589e\u8d77\u59cb\u6570\n    AUTO_INCREMENT = \u884c\u6570\n    -- \u6570\u636e\u6587\u4ef6\u76ee\u5f55\n    DATA DIRECTORY = '\u76ee\u5f55'\n    -- \u7d22\u5f15\u6587\u4ef6\u76ee\u5f55\n    INDEX DIRECTORY = '\u76ee\u5f55'\n    -- \u8868\u6ce8\u91ca\n    COMMENT = 'string'\n    -- \u5206\u533a\u9009\u9879\n    PARTITION BY ... (\u8be6\u7ec6\u89c1\u624b\u518c)\n\neg. \n\nDROP TABLE IF EXISTS `adx_adinfo_sync`;\nCREATE TABLE `adx_adinfo_sync` (\n`adId`\xa0\xa0varchar(20) NOT NULL COMMENT '\u5185\u90e8\u5e7f\u544a\u4f4did',\n`dsp_id`\xa0\xa0varchar(20) NOT NULL COMMENT 'dsp\u5728ADX\u7cfb\u7edf\u4e2d\u7684ID',\n`adTitle` varchar(200) NOT NULL DEFAULT '' COMMENT '\u5e7f\u544a\u6807\u9898' ,\n`adv_adId` varchar(20) NOT NULL DEFAULT '' COMMENT 'dsp\u5e7f\u544aid' ,\n`adStyle` varchar(100) NOT NULL DEFAULT '' COMMENT '\u5e7f\u544a\u7c7b\u578b',\n`advertiser`\xa0\xa0varchar(500) NOT NULL DEFAULT '' COMMENT '\u5e7f\u544a\u4e3b\u540d\u79f0',\n`adurl` varchar(500) DEFAULT '' COMMENT '\u5e7f\u544a\u843d\u5730\u9875' ,\n`img1Path` varchar(200) DEFAULT '' COMMENT '\u5e7f\u544a\u56fe\u72471' ,\n`img2Path` varchar(200) DEFAULT '' COMMENT '\u5e7f\u544a\u56fe\u72472' ,\n`img3Path` varchar(200) DEFAULT '' COMMENT '\u5e7f\u544a\u56fe\u72473' ,\n`img4Path` varchar(200) DEFAULT '' COMMENT '\u5e7f\u544a\u56fe\u72474' ,\n`img5Path` varchar(200) DEFAULT '' COMMENT '\u5e7f\u544a\u56fe\u72475' ,\n`img6Path` varchar(200) DEFAULT '' COMMENT '\u5e7f\u544a\u56fe\u72476' ,\n`adIntroduction` varchar(200) DEFAULT '' COMMENT '\u5e7f\u544a\u63cf\u8ff0',\n`keyword` varchar(3000) DEFAULT '' COMMENT '\u5173\u952e\u5b57',\n`isdownload` varchar(1) DEFAULT '0' COMMENT '\u662f\u5426\u4e0b\u8f7d\u7c7b\u5e7f\u544a',\n`isgrayav` tinyint(1) DEFAULT '0' COMMENT '\u662f\u5426\u662f\u7070\u8272\u5e7f\u544a',\n`comments` varchar(1000) DEFAULT '' COMMENT '\u5e7f\u544a\u7d20\u6750\u5ba1\u6838\u610f\u89c1',\n`downloadlink` varchar(500) DEFAULT '' COMMENT '\u4e0b\u8f7d\u7c7b\u5e7f\u544a\u94fe\u63a5',\n`reviewstatus` tinyint(1) NOT NULL DEFAULT 0\xa0\xa0COMMENT '0:\u672a\u5ba1\u6838 1:\u5ba1\u6838\u901a\u8fc7 -1:\u5ba1\u6838\u672a\u901a\u8fc7',\n`status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '1:\u6b63\u5e38 0:\u6295\u653e\u7ed3\u675f -1:\u5e7f\u544a\u4f5c\u5e9f',\n`createtime` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n`updatetime` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '\u4fee\u6539\u65f6\u95f4',\n`startTime` TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '\u7d20\u6750\u6709\u6548\u5f00\u59cb\u65f6\u95f4',\n`endTime` TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '\u7d20\u6750\u6709\u6548\u7ed3\u675f\u65f6\u95f4',\n`remark` varchar(1000) NOT NULL DEFAULT '' COMMENT '\u5907\u6ce8\u4fe1\u606f',\n`showrep` varchar(5000) NOT NULL DEFAULT '' COMMENT '\u5c55\u73b0\u4e0a\u62a5',\n`clickrep` varchar(5000) NOT NULL DEFAULT '' COMMENT '\u70b9\u51fb\u4e0a\u62a5',\nPRIMARY KEY (`adId`),\nUNIQUE KEY `dsp_id_advid` (`dsp_id`,`adv_adId`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n\n\n")),(0,r.kt)("p",null,"\u5efa\u8868\u89c4\u8303"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"    -- Normal Format, NF\n        - \u6bcf\u4e2a\u8868\u4fdd\u5b58\u4e00\u4e2a\u5b9e\u4f53\u4fe1\u606f\n        - \u6bcf\u4e2a\u5177\u6709\u4e00\u4e2aID\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\n        - ID\u4e3b\u952e + \u539f\u5b50\u8868\n    -- 1NF, \u7b2c\u4e00\u8303\u5f0f\n        \u5b57\u6bb5\u4e0d\u80fd\u518d\u5206\uff0c\u5c31\u6ee1\u8db3\u7b2c\u4e00\u8303\u5f0f\u3002\n    -- 2NF, \u7b2c\u4e8c\u8303\u5f0f\n        \u6ee1\u8db3\u7b2c\u4e00\u8303\u5f0f\u7684\u524d\u63d0\u4e0b\uff0c\u4e0d\u80fd\u51fa\u73b0\u90e8\u5206\u4f9d\u8d56\u3002\n        \u6d88\u9664\u7b26\u5408\u4e3b\u952e\u5c31\u53ef\u4ee5\u907f\u514d\u90e8\u5206\u4f9d\u8d56\u3002\u589e\u52a0\u5355\u5217\u5173\u952e\u5b57\u3002\n    -- 3NF, \u7b2c\u4e09\u8303\u5f0f\n        \u6ee1\u8db3\u7b2c\u4e8c\u8303\u5f0f\u7684\u524d\u63d0\u4e0b\uff0c\u4e0d\u80fd\u51fa\u73b0\u4f20\u9012\u4f9d\u8d56\u3002\n        \u67d0\u4e2a\u5b57\u6bb5\u4f9d\u8d56\u4e8e\u4e3b\u952e\uff0c\u800c\u6709\u5176\u4ed6\u5b57\u6bb5\u4f9d\u8d56\u4e8e\u8be5\u5b57\u6bb5\u3002\u8fd9\u5c31\u662f\u4f20\u9012\u4f9d\u8d56\u3002\n        \u5c06\u4e00\u4e2a\u5b9e\u4f53\u4fe1\u606f\u7684\u6570\u636e\u653e\u5728\u4e00\u4e2a\u8868\u5185\u5b9e\u73b0\u3002\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u67e5\u770b\u8868\u7ed3\u6784")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW CREATE TABLE \u8868\u540d\nDESC \u8868\u540d\n\n-- \u4f18\u5316\u8868\nOPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...\n\n-- \u5206\u6790\u8868\nANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...\n\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u5220\u9664"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5220\u9664\u8868\nDROP TABLE [IF EXISTS] \u8868\u540d\n\n-- \u6e05\u7a7a\u8868\nTRUNCATE [TABLE] \u8868\u540d\n\n# \u5220\u9664\u6570\u636e\u5e93\u6240\u6709\u8868\nSELECT CONCAT('DROP TABLE ', TABLE_NAME, ';') FROM information_schema.`TABLES` WHERE table_schema = 'dbname'\n\n\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u4fee\u6539\u8868"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4fee\u6539\u8868\u672c\u8eab\u5c5e\u6027\nALTER TABLE \u8868\u540d \u8868\u7684\u9009\u9879\neg: ALTER TABLE \u8868\u540d ENGINE=MYISAM;\n\n-- \u4fee\u6539\u8868\u540d\nalter table \u65e7\u8868\u540d rename as \u65b0\u8868\u540d\nRENAME TABLE \u539f\u8868\u540d TO \u5e93\u540d.\u8868\u540d\n\n-- \u4fee\u6539\u8868\u5b57\u6bb5\nALTER TABLE \u8868\u540d \u64cd\u4f5c\u540d\n    -- \u64cd\u4f5c\u540d\n    ADD[ COLUMN] \u5b57\u6bb5\u5b9a\u4e49       -- \u589e\u52a0\u5b57\u6bb5\n        AFTER \u5b57\u6bb5\u540d          -- \u8868\u793a\u589e\u52a0\u5728\u8be5\u5b57\u6bb5\u540d\u540e\u9762\n        FIRST               -- \u8868\u793a\u589e\u52a0\u5728\u7b2c\u4e00\u4e2a\n    ADD PRIMARY KEY(\u5b57\u6bb5\u540d)   -- \u521b\u5efa\u4e3b\u952e\n    ADD UNIQUE [\u7d22\u5f15\u540d] (\u5b57\u6bb5\u540d)-- \u521b\u5efa\u552f\u4e00\u7d22\u5f15\n    ADD INDEX [\u7d22\u5f15\u540d] (\u5b57\u6bb5\u540d) -- \u521b\u5efa\u666e\u901a\u7d22\u5f15\n    DROP[ COLUMN] \u5b57\u6bb5\u540d      -- \u5220\u9664\u5b57\u6bb5\n    MODIFY[ COLUMN] \u5b57\u6bb5\u540d \u5b57\u6bb5\u5c5e\u6027     -- \u652f\u6301\u5bf9\u5b57\u6bb5\u5c5e\u6027\u8fdb\u884c\u4fee\u6539\uff0c\u4e0d\u80fd\u4fee\u6539\u5b57\u6bb5\u540d(\u6240\u6709\u539f\u6709\u5c5e\u6027\u4e5f\u9700\u5199\u4e0a)\n    CHANGE[ COLUMN] \u539f\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u5b57\u6bb5\u5c5e\u6027      -- \u652f\u6301\u5bf9\u5b57\u6bb5\u540d\u4fee\u6539\n    DROP PRIMARY KEY    -- \u5220\u9664\u4e3b\u952e(\u5220\u9664\u4e3b\u952e\u524d\u9700\u5220\u9664\u5176AUTO_INCREMENT\u5c5e\u6027)\n    DROP INDEX \u7d22\u5f15\u540d -- \u5220\u9664\u7d22\u5f15\n    DROP FOREIGN KEY \u5916\u952e    -- \u5220\u9664\u5916\u952e\n\n\n")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u590d\u5236\u8868"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4ec5\u8868\u7ed3\u6784\nCREATE TABLE \u8868\u540d LIKE \u8981\u590d\u5236\u7684\u8868\u540d\n\n-- \u8868\u7ed3\u6784\u548c\u6570\u636e\nCREATE TABLE \u8868\u540d [AS] SELECT * FROM \u8981\u590d\u5236\u7684\u8868\u540d\nINSERT INTO `t_tempupdatedata` SELECT * FROM `t_tempupdatedata_recycle`\n")),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u67e5\u8be2\u5b57\u6bb5\u540d\u53ca\u6ce8\u91ca"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT COLUMN_NAME,column_comment,data_type FROM INFORMATION_SCHEMA.Columns WHERE table_name='tablename' AND table_schema='dbname';\n")),(0,r.kt)("h3",{id:"\u8868\u5b57\u6bb5"},"\u8868\u5b57\u6bb5"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u589e\u52a0"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"alter table \u8868\u540d add \u5b57\u6bb5\u540d \u5217\u7c7b\u578b [\u5c5e\u6027]\n\nALTER TABLE adplatform_app_slotid ADD COLUMN issdk VARCHAR(100) NOT NULL DEFAULT '0'\xa0COMMENT '\u662f\u5426\u662fSDK' AFTER os;\n-- \u793a\u4f8b\nALTER TABLE t_application ADD COLUMN `app_msg_notify_mode` VARCHAR(20) DEFAULT 'WEBHOOK' COMMENT '\u5e94\u7528\u6d88\u606f\u901a\u77e5\u65b9\u5f0f:WEBHOOK/MQ' AFTER access_key;  \nALTER TABLE t_application ADD COLUMN `webhook_url` VARCHAR(255) NULL COMMENT '\u5e94\u7528\u6d88\u606f\u901a\u77e5\u5730\u5740' AFTER app_msg_notify_mode;\n\n\u540c\u65f6\u589e\u52a0\u591a\u5217\uff1a\nALTER TABLE `t_intelligentterminal`\nADD COLUMN `status` TINYINT(1)\xa0\xa0DEFAULT 0 COMMENT '\u8bbe\u5907\u72b6\u60010:\u5df2\u6ce8\u518c\u672a\u51fa\u552e; 1:\u5df2\u51fa\u552e' AFTER `CCID`,\nADD COLUMN `Qrcode` VARCHAR(20)\xa0\xa0DEFAULT NULL COMMENT '\u4e8c\u7ef4\u7801\u626b\u63cf\u6ce8\u518c\uff0c\u4e8c\u7ef4\u7801\u4fe1\u606f' AFTER `CCID`,\nADD COLUMN `Pwd` VARCHAR(8)\xa0\xa0DEFAULT NULL COMMENT '\u7528\u6237\u5bc6\u7801' AFTER `CCID`,\nADD COLUMN `User` VARCHAR(10)\xa0\xa0DEFAULT NULL COMMENT '\u7528\u6237\u540d' AFTER `CCID`,\nADD COLUMN `Port` VARCHAR(5)\xa0\xa0DEFAULT NULL COMMENT 'Mqtt\u670d\u52a1\u5668\u7aef\u53e3' AFTER `CCID`,\nADD COLUMN `HostName` VARCHAR(32)\xa0\xa0DEFAULT NULL COMMENT 'Mqtt\u670d\u52a1\u5668\u5730\u5740' AFTER `CCID`;\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u5220\u9664\u5b57\u6bb5"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE \u8868\u540d DROP COLUMN \u5b57\u6bb5\u540d\n\nALTER TABLE t_printer DROP COLUMN online;\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u4fee\u6539\u5b57\u6bb5\u5b9a\u4e49"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4fee\u6539\u8868\u5b57\u6bb5\nALTER TABLE t_cloud_print MODIFY COLUMN `printed_papers` int(10) unsigned DEFAULT '0' COMMENT '\u5df2\u6253\u5370\u7eb8\u5f20\u6570\uff0c\u7531\u8bbe\u5907\u4e0a\u62a5';\n\n\n-- \u4fee\u6539\u81ea\u589e\u957f\u503c\nSELECT AUTO_INCREMENT FROM information_schema.`TABLES` WHERE table_schema='oilset' AND table_name = 'sys_config';\nALTER TABLE sys_config AUTO_INCREMENT = 18\n\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u66f4\u65b0\u6570\u636e"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-SQL"},"UPDATE t_cloud_print SET task_create_time=task_create_time*1000 WHERE task_create_time<10000000000;\n")),(0,r.kt)("h3",{id:"\u67e5\u8be2"},"\u67e5\u8be2"),(0,r.kt)("h3",{id:"-rownum\u67e5\u8be2\u8bb0\u5f55\u5728\u5f53\u524d\u7ed3\u679c\u96c6\u7684\u884c\u53f7"},"@ rownum\u67e5\u8be2\u8bb0\u5f55\u5728\u5f53\u524d\u7ed3\u679c\u96c6\u7684\u884c\u53f7"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-SQL"},'-- (SELECT @rownum := 0) temp \u4e3a\u4e00\u5f20\u4e34\u65f6\u8868\u3002\u884c\u53f7\u7ed3\u679c\u4ece 1 \u5f00\u59cb\nSELECT id, task_code, @rownum :=@rownum + 1 AS item FROM\n    tm_printer_task t ,\n     (SELECT @rownum := 0) temp\nWHERE\n    t.printer_sn = \'M2005DN_198110843\' \n    AND t.task_status IN (\'cancel\') \n    AND t.whether_delete = 0;\n\n-- Repository \u5b8c\u6210\u4ee3\u7801\uff1a\u67e5\u8be2\u5f53\u524d\u4efb\u52a1\u7684\u6392\u884c\n@Query(value = "select b.rownum from (select @rownum\\\\:=@rownum+1 as rownum,t.task_code from " +  \n        "(SELECT @rownum\\\\:=0) r , tm_printer_task t where t.printer_sn = ?1 and t.task_status in" +  \n        " (?2) and t.whether_delete = 0 ) b where b.task_code = ?3", nativeQuery = true)  \nInteger queryRank(String printerSn, List<String> status, String taskCode);\n\n')),(0,r.kt)("h3",{id:"\u8868\u6570\u636e"},"\u8868\u6570\u636e"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u65b0\u589e"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"\nINSERT [INTO] \u8868\u540d [(\u5b57\u6bb5\u5217\u8868)] VALUES (\u503c\u5217\u8868)[, (\u503c\u5217\u8868), ...]\n\ninsert into emp (name,lastname,dept) values('new name','new last name','Accounts');\n\ninsert into emp (id,name,lastname,dept) values('key that already exists', 'new name','new last name','Accounts')\non duplicate KEY UPDATE name='default name', lastname='default last name';\n\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u67e5\u8be2"),(0,r.kt)("img",{parentName:"li",src:"https://gitee.com/Hans213/FigureBed/raw/master/2020/01//20200131141944.png",alt:null}))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT [ALL|DISTINCT] select_expr FROM -> WHERE -> GROUP BY [\u5408\u8ba1\u51fd\u6570] -> HAVING -> ORDER BY -> LIMIT\n\n-- \u5185\u8fde\u63a5(inner join)\n    - \u9ed8\u8ba4\u5c31\u662f\u5185\u8fde\u63a5\uff0c\u53ef\u7701\u7565inner\u3002\n    - \u53ea\u6709\u6570\u636e\u5b58\u5728\u65f6\u624d\u80fd\u53d1\u9001\u8fde\u63a5\u3002\u5373\u8fde\u63a5\u7ed3\u679c\u4e0d\u80fd\u51fa\u73b0\u7a7a\u884c\u3002\n    on \u8868\u793a\u8fde\u63a5\u6761\u4ef6\u3002\u5176\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e0ewhere\u7c7b\u4f3c\u3002\u4e5f\u53ef\u4ee5\u7701\u7565\u6761\u4ef6\uff08\u8868\u793a\u6761\u4ef6\u6c38\u8fdc\u4e3a\u771f\uff09\n    \u4e5f\u53ef\u7528where\u8868\u793a\u8fde\u63a5\u6761\u4ef6\u3002\n    \u8fd8\u6709 using, \u4f46\u9700\u5b57\u6bb5\u540d\u76f8\u540c\u3002using(\u5b57\u6bb5\u540d)\n\n    -- \u4ea4\u53c9\u8fde\u63a5 cross join\n        \u5373\uff0c\u6ca1\u6709\u6761\u4ef6\u7684\u5185\u8fde\u63a5\u3002\n        select * from tb1 cross join tb2;\n-- \u5916\u8fde\u63a5(outer join)\n    - \u5982\u679c\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u4e5f\u4f1a\u51fa\u73b0\u5728\u8fde\u63a5\u7ed3\u679c\u4e2d\u3002\n    -- \u5de6\u5916\u8fde\u63a5 left join\n        \u5982\u679c\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u5de6\u8868\u8bb0\u5f55\u4f1a\u51fa\u73b0\uff0c\u800c\u53f3\u8868\u4e3anull\u586b\u5145\n    -- \u53f3\u5916\u8fde\u63a5 right join\n        \u5982\u679c\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u53f3\u8868\u8bb0\u5f55\u4f1a\u51fa\u73b0\uff0c\u800c\u5de6\u8868\u4e3anull\u586b\u5145\n\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u5220\u9664"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM \u8868\u540d[ \u5220\u9664\u6761\u4ef6\u5b50\u53e5]\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u4fee\u6539"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"UPDATE \u8868\u540d SET \u5b57\u6bb5\u540d=\u65b0\u503c[, \u5b57\u6bb5\u540d=\u65b0\u503c] [\u66f4\u65b0\u6761\u4ef6]\n")),(0,r.kt)("h3",{id:"\u7d22\u5f15\u4e3b\u952e\u5916\u952e"},"\u7d22\u5f15\u3001\u4e3b\u952e\u3001\u5916\u952e"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/create-index.html"},"https://dev.mysql.com/doc/refman/5.7/en/create-index.html")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-SQL"},"CREATE [UNIQUE | FULLTEXT | SPATIAL] INDEX index_name\n    [index_type]\n    ON tbl_name (key_part,...)\n    [index_option]\n    [algorithm_option | lock_option] ...\n\nkey_part:\n    col_name [(length)] [ASC | DESC]\n\nindex_option: {\n    KEY_BLOCK_SIZE [=] value\n  | index_type\n  | WITH PARSER parser_name\n  | COMMENT 'string'\n}\n\nindex_type:\n    USING {BTREE | HASH}\n\nalgorithm_option:\n    ALGORITHM [=] {DEFAULT | INPLACE | COPY}\n\nlock_option:\n    LOCK [=] {DEFAULT | NONE | SHARED | EXCLUSIVE}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u666e\u901a\u7d22\u5f15\nALTER TABLE t_file_record ADD INDEX idx_orderId ( convert_order_id );\n\nCREATE INDEX part_of_name ON customer (name(10));\n\n-- \u552f\u4e00\u7d22\u5f15\nCREATE UNIQUE INDEX uk_printerSn_appId ON t_printer_bind (printer_sn, app_id) USING BTREE COMMENT '\u6253\u5370\u673aSN, \u5e94\u7528ID\u552f\u4e00\u7d22\u5f15';\n\n-- \u5220\u9664\u7d22\u5f15\nDROP INDEX index_name ON table_name\n\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u4e3b\u952e")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"# \u65b0\u5efa\u4e3b\u952e\n\u65b0\u589e(\u590d\u5408)\u4e3b\u952e\uff1a\nALTER TABLE `t_intelligentterminalonoff` ADD PRIMARY KEY(id, ThisTime);\n\u8054\u5408\u4e3b\u952e-\u662f\u6307\u901a\u8fc7\u591a\u5f20\u8868\u7684\u591a\u4e2a\u4e3b\u952e\u786e\u5b9a\u552f\u4e00\u8bb0\u5f55\u3002\uff08\u6211\u7684\u7406\u89e3\u5c31\u662f\u4e2d\u95f4\u8868\u4e2d\u7684id\uff09\n\n# \u5220\u9664\u4e3b\u952e\nALTER TABLE `t_intelligentterminalonoff` DROP PRIMARY KEY;\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"1. PRIMARY \u4e3b\u952e\n    - \u80fd\u552f\u4e00\u6807\u8bc6\u8bb0\u5f55\u7684\u5b57\u6bb5\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u4e3b\u952e\u3002\n    - \u4e00\u4e2a\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u4e3b\u952e\u3002\n    - \u4e3b\u952e\u5177\u6709\u552f\u4e00\u6027\u3002\n    - \u58f0\u660e\u5b57\u6bb5\u65f6\uff0c\u7528 primary key \u6807\u8bc6\u3002\n        \u4e5f\u53ef\u4ee5\u5728\u5b57\u6bb5\u5217\u8868\u4e4b\u540e\u58f0\u660e\n            \u4f8b\uff1acreate table tab ( id int, stu varchar(10), primary key (id));\n    - \u4e3b\u952e\u5b57\u6bb5\u7684\u503c\u4e0d\u80fd\u4e3anull\u3002\n    - \u4e3b\u952e\u53ef\u4ee5\u7531\u591a\u4e2a\u5b57\u6bb5\u5171\u540c\u7ec4\u6210\u3002\u6b64\u65f6\u9700\u8981\u5728\u5b57\u6bb5\u5217\u8868\u540e\u58f0\u660e\u7684\u65b9\u6cd5\u3002\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5916\u952e")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"# \u65b0\u5efa\u5916\u952e\nALTER TABLE \u8868\u540d ADD CONSTRAINT FK_ID FOREIGN KEY(\u5916\u952e\u5b57\u6bb5\u540d) REFERENCES \u5916\u8868\u8868\u540d(\u4e3b\u952e\u5b57\u6bb5\u540d);\n# \u5220\u9664\u5916\u952e\nALTER TABLE \u8868\u540d DROP FOREIGN KEY \u5916\u952e\u540d;\n")),(0,r.kt)("h3",{id:"\u51fd\u6570\u5b58\u50a8\u8fc7\u7a0b"},"\u51fd\u6570\u3001\u5b58\u50a8\u8fc7\u7a0b"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u51fd\u6570")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-SQL"},"DELIMITER $$\n\nCREATE FUNCTION `rand_string`(n INT) RETURNS VARCHAR(255)\nBEGIN\n    DECLARE chars_str VARCHAR(100) DEFAULT 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    DECLARE return_str VARCHAR(255) DEFAULT '';\n    DECLARE i INT DEFAULT 0;\n    WHILE i < n DO\n        SET return_str = CONCAT(return_str,SUBSTRING(chars_str , FLOOR(1 + RAND()*62 ),1));\n        SET i = i +1;\n    END WHILE;\n    RETURN return_str;\nEND $$\n\nDELIMITER ;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-SQL"},"-- \u8c03\u7528\u51fd\u6570\nSELECT rand_string(100);\n-- \u5220\u9664\u51fd\u6570\nDROP FUNCTION `rand_string`;\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5b58\u50a8\u8fc7\u7a0b")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"\nDROP PROCEDURE IF EXISTS `proc_appunionweight`;\nDELIMITER $$\nCREATE PROCEDURE `proc_appunionweight`(v_apitype VARCHAR(50))\nBEGIN\n\xa0\xa0\xa0\xa0SELECT\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0CASE\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0WHEN apptypeid <> '' AND appqid <> '' AND slotid <> '' THEN CONCAT_WS('_',apptypeid,appqid,slotid)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0WHEN apptypeid <> '' AND appqid = '' AND slotid <> '' THEN CONCAT_WS('_',apptypeid,slotid)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0WHEN apptypeid = '' AND appqid = '' AND slotid <> '' THEN slotid\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0END AS configtypeid,\n\xa0\xa0\xa0\xa0apptypeid,\n\xa0\xa0\xa0\xa0appver AS configversion,\n\xa0\xa0\xa0\xa0os,\n\xa0\xa0\xa0\xa0weightver AS version,\n\xa0\xa0\xa0\xa0uniontype AS configname,\n\xa0\xa0\xa0\xa0weight AS value,\n\xa0\xa0\xa0\xa0packagepath,\n\xa0\xa0\xa0\xa0issdk\n\xa0\xa0\xa0\xa0FROM adplatform_app_slotid\xa0\xa0WHERE enable = 'Y' AND enableweight='Y' AND FIND_IN_SET(v_apitype,apitype) ORDER BY configtypeid DESC,weightver DESC;\n\xa0\xa0\xa0\xa0\nEND $$\nDELIMITER ;\n\n\n\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5e26\u5165\u53c2\u548c\u8fd4\u56de\u503c")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DROP PROCEDURE IF EXISTS `proc_editbiddinginfo`;\nDELIMITER $$\nCREATE PROCEDURE `proc_editbiddinginfo`(varplatform varchar(20),varqid VARCHAR(50),varlocationtype VARCHAR(50),varcpm VARCHAR(20),\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 varsourcetype VARCHAR(50),varimpression VARCHAR(20),varclick VARCHAR(20),varincome VARCHAR(20),varctr VARCHAR(20),varcpc VARCHAR(20))\nBEGIN\n\xa0DECLARE sp_error INT DEFAULT 0;\xa0\n\xa0DECLARE result INT DEFAULT 0;\xa0\n\xa0DECLARE CONTINUE HANDLER FOR SQLEXCEPTION SET sp_error=1;\xa0\n\xa0IF varplatform = 'app' THEN\xa0\n\xa0 \xa0 UPDATE adver_position_cpm_for_bid_by_app\n\xa0 \xa0 SET cpm = varcpm,sourcetype=varsourcetype,impression=varimpression,click=varclick,income=varincome,ctr=varctr,cpc=varcpc\n\xa0 \xa0 WHERE\xa0\n\xa0 \xa0 qid = varqid AND locationtype = varlocationtype;\n\xa0 \xa0 SET result = 1;\n\xa0ELSEIF varplatform = 'h5' THEN\xa0\n\xa0 \xa0 IF varqid = 'other' THEN\n\xa0 \xa0 \xa0 UPDATE adver_position_cpm_for_bid_fake\n\xa0 \xa0 \xa0 SET cpm = varcpm,sourcetype=varsourcetype,impression=varimpression,click=varclick,income=varincome,ctr=varctr,cpc=varcpc\n\xa0 \xa0 \xa0 WHERE\xa0\n\xa0 \xa0 \xa0 qid = varqid AND locationtype = varlocationtype;\n\xa0 \xa0 ELSE\n\xa0 \xa0 \xa0 UPDATE adver_position_cpm_for_bid_qid\n\xa0 \xa0 \xa0 SET cpm = varcpm,sourcetype=varsourcetype,impression=varimpression,click=varclick,income=varincome,ctr=varctr,cpc=varcpc\n\xa0 \xa0 \xa0 WHERE\xa0\n\xa0 \xa0 \xa0 qid = varqid AND locationtype = varlocationtype;\n\xa0 \xa0 END IF;\n\xa0 \xa0 SET result = 1;\n\xa0ELSEIF varplatform = 'pc' THEN\xa0\n\xa0 \xa0 UPDATE adver_position_cpm_for_bid_fake\n\xa0 \xa0 SET cpm = varcpm,sourcetype=varsourcetype,impression=varimpression,click=varclick,income=varincome,ctr=varctr,cpc=varcpc\n\xa0 \xa0 WHERE\xa0\n\xa0 \xa0 qid = varqid AND locationtype = varlocationtype;\n\xa0 \xa0 SET result = 1;\n\xa0END IF;\n\xa0IF sp_error=1 THEN\n\xa0 \xa0 SELECT sp_error;\n\xa0 \xa0 ROLLBACK;\n\xa0ELSE\n\xa0 \xa0 SELECT result;\n\xa0 \xa0 COMMIT;\n\xa0END IF;\nEND $$\nDELIMITER ;\n\n")),(0,r.kt)("h3",{id:"\u89e6\u53d1\u5668\u89c6\u56fe\u5b9a\u65f6\u4efb\u52a1"},"\u89e6\u53d1\u5668\u3001\u89c6\u56fe\u3001\u5b9a\u65f6\u4efb\u52a1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"1.\u521b\u5efa\u89e6\u53d1\u5668\n\n# \u67e5\u770b\u89e6\u53d1\nSHOW TRIGGERS;\n# \u5220\u9664\u89e6\u53d1\u5668\nDROP TRIGGER trigger_name;\n\n# \u793a\u4f8b\nDROP TRIGGER\xa0Delete_TempData_Trigger\n\nDELIMITER $$\n\nCREATE TRIGGER `Delete_TempData_Trigger` BEFORE\nDELETE ON `t_tempupdatedata` FOR EACH ROW BEGIN\nINSERT INTO t_tempupdatedata_recycle(UID, CheckDate, InstrumentId,\xa0DataText, CreateDate, Remark) VALUES(old.UID, old.CheckDate, old.InstrumentId, old.DataText, old.CreateDate, old.Remark);\n\nEND;\n$$\n\n\n# \u4e8b\u4ef6\n\nDELIMITER ;\n\nDROP PROCEDURE IF EXISTS `proc_taskitem_split`;\nDELIMITER $$\nCREATE PROCEDURE `proc_taskitem_split`(varpermissive VARCHAR(20))\nBEGIN\n\xa0\xa0\xa0\xa0DECLARE sp_error INT DEFAULT 0;\n\xa0\xa0\xa0\xa0DECLARE in_time VARCHAR(20) DEFAULT DATE_FORMAT(DATE_SUB(NOW(),INTERVAL 60 DAY),'%Y-%m-%d %H:%i:%s');\n\xa0\xa0\xa0\xa0DECLARE CONTINUE HANDLER FOR SQLEXCEPTION SET sp_error=1;\n\xa0\xa0\xa0\xa0\n\xa0\xa0\xa0\xa0START TRANSACTION;\n\xa0\xa0\xa0\xa0\n\xa0\xa0\xa0\xa0IF(varpermissive='permissive') THEN\xa0\xa0\xa0\xa0\n\xa0\xa0\xa0\xa0INSERT INTO t_taskitem_bak SELECT * FROM t_taskitem WHERE CreateTime<in_time;\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\n\xa0\xa0\xa0\xa0END IF;\n\xa0\xa0\xa0\xa0\nIF sp_error=1 THEN\n\xa0\xa0\xa0\xa0SELECT sp_error;\n\xa0\xa0\xa0\xa0ROLLBACK;\nELSE\n\xa0\xa0\xa0\xa0IF(varpermissive='permissive') THEN\n\xa0\xa0\xa0\xa0DELETE FROM t_taskitem WHERE CreateTime<in_time;\n\xa0\xa0\xa0\xa0END IF;\xa0\xa0\xa0\xa0\n\xa0\xa0\xa0\xa0SELECT sp_error;\n\xa0\xa0\xa0\xa0COMMIT;\nEND IF;\nEND $$\nDELIMITER ;\n\n\n# \u65b0\u5efa\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u65f6\u590d\u5236\u6570\u636e\u5230\u5907\u4efd\u8868\nDELIMITER $$\n\nDROP EVENT IF EXISTS e_taskitem_split_backup $$\nCREATE EVENT e_taskitem_split_backup\nON SCHEDULE EVERY 24 HOUR STARTS TIMESTAMP '2019-01-24 12:30:00'\nON COMPLETION PRESERVE\nDO\nBEGIN\nCALL proc_taskitem_split('permissive');\nEND $$\n\n\n\u67e5\u770b\u5b9a\u65f6\u4efb\u52a1\u5f00\u542f\u72b6\u6001\uff1a\nshow variables like '%event_sche%';\n\u5f00\u542f\uff1aset global event_scheduler=1;\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELIMITER $$\n\nDROP EVENT IF EXISTS event_das_car_info $$\nCREATE EVENT event_das_car_info\nON SCHEDULE EVERY 24 HOUR STARTS TIMESTAMP '2020-09-09 23:45:00'\nON COMPLETION PRESERVE\nDO\nBEGIN\n\n UPDATE t_car_identification_info SET `status` = 0 WHERE `status` = 1 AND start_time = end_time AND start_time < DATE_SUB(NOW(),INTERVAL 24 HOUR);\n \nEND $$\n\nDELIMITER ;\n\n")),(0,r.kt)("p",null,"\u5047\u5982\u5728\u5b9a\u4e49event\u7684\u65f6\u5019\u6709\u6307\u5b9aends\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u4e3aon completion preserve \u7684\u65f6\u5019,\u5f53event\u5230\u671f\u4e86,event\u4f1a\u88abdisable,\u4f46\u662f\u8be5event\u8fd8\u662f\u4f1a\u5b58\u5728"),(0,r.kt)("li",{parentName:"ul"},"\u5f53\u4e3aon completion not preserve\u7684\u65f6\u5019,\u5f53event\u5230\u671f\u7684\u65f6\u5019,\u8be5event\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\u6389.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u65b0\u5efa\u89c6\u56fe")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"\nDROP VIEW IF EXISTS `v_sysuser`;\n\nCREATE VIEW v_sysuser AS\n\nSELECT su.*, sr.id roleid, sr.rolename rolename, sr.RoleKey rolekey, com.CompanyName companyname, a.UserName creator, b.UserName updator FROM sys_user su\nLEFT JOIN `sys_user_role` sur ON su.ID = sur.UserId\nLEFT JOIN `sys_role` sr ON sur.UserRoleId = sr.id AND sr.isDelete = 0\nLEFT JOIN `t_company` com ON com.id = su.CompanyId AND com.IsDelete = 0\nLEFT JOIN `sys_user` a ON a.id = su.UpdateManId\nLEFT JOIN `sys_user` b ON b.id = su.UpdateManId;\n\nSELECT * FROM v_sysuser;\n\n--------\n\nDROP VIEW IF EXISTS `v_gasgun`;\n\nCREATE VIEW v_gasgun AS\n\nSELECT gun.*, `mac`.`ID` AS `MachineId`,\xa0\xa0`mac`.`GasMachineName` AS `MachineName`,\xa0\xa0`mac`.`Model` AS `Model`,\xa0\xa0`mac`.`FactoryNo` AS `FactoryNo`,\xa0\xa0\n`sta`.`ID` AS `StationId`,\xa0\xa0`sta`.`LabelID` AS `LabelID`,\xa0\xa0`sta`.`GasStationName` AS `GasStationName`,\xa0\xa0\n`com`.`ID` AS `CompanyId`,\xa0\xa0`com`.`UniqueId` AS `UniqueId`,\xa0\xa0`com`.`CompanyName` AS `CompanyName` FROM\n(((`t_gasgun` `gun`\xa0\xa0\nLEFT JOIN `t_gasmachine` `mac`\xa0\xa0ON ((`gun`.`GasMachineId` = `mac`.`ID`)))\xa0\xa0\nLEFT JOIN `t_gasstation` `sta`\xa0\xa0ON ((`mac`.`BelongGasStationID` = `sta`.`ID`)))\xa0\xa0\nLEFT JOIN `t_company` `com`\xa0\xa0ON ((`sta`.`UUID` = `com`.`ID`)))\nWHERE gun.IsDelete = 0;\n\nSELECT * FROM v_gasgun;\n")),(0,r.kt)("h3",{id:"\u67e5\u8be2mysql\u914d\u7f6e"},"\u67e5\u8be2MySQL\u914d\u7f6e"),(0,r.kt)("h4",{id:"\u6570\u636e\u5e93\u5b57\u7b26\u96c6"},"\u6570\u636e\u5e93\u5b57\u7b26\u96c6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'SHOW VARIABLES LIKE "%char%";\n')),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/hyman213/FigureBed/master/2019/10/20191028163327.png",alt:null})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"MySQL \u4e2d\u5b57\u7b26\u96c6\u76f8\u5173\u53d8\u91cf")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"character_set_client\uff1a\u5ba2\u6237\u7aef\u8bf7\u6c42\u6570\u636e\u7684\u5b57\u7b26\u96c6\ncharacter_set_connection\uff1a\u4ece\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u6570\u636e\uff0c\u7136\u540e\u4f20\u8f93\u7684\u5b57\u7b26\u96c6\ncharacter_set_database\uff1a\u9ed8\u8ba4\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6\uff0c\u65e0\u8bba\u9ed8\u8ba4\u6570\u636e\u5e93\u5982\u4f55\u6539\u53d8\uff0c\u90fd\u662f\u8fd9\u4e2a\u5b57\u7b26\u96c6\uff1b\u5982\u679c\u6ca1\u6709\u9ed8\u8ba4\u6570\u636e\u5e93\uff0c\u90a3\u5c31\u4f7f\u7528 character_set_server\u6307\u5b9a\u7684\u5b57\u7b26\u96c6\uff0c\u8fd9\u4e2a\u53d8\u91cf\u5efa\u8bae\u7531\u7cfb\u7edf\u81ea\u5df1\u7ba1\u7406\uff0c\u4e0d\u8981\u4eba\u4e3a\u5b9a\u4e49\u3002\ncharacter_set_filesystem\uff1a\u628a\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u540d\u8f6c\u5316\u6210\u6b64\u5b57\u7b26\u96c6\uff0c\u5373\u628a character_set_client\u8f6c\u6362character_set_filesystem\uff0c \u9ed8\u8ba4binary\u662f\u4e0d\u505a\u4efb\u4f55\u8f6c\u6362\u7684\ncharacter_set_results\uff1a\u7ed3\u679c\u96c6\u7684\u5b57\u7b26\u96c6\ncharacter_set_server\uff1a\u6570\u636e\u5e93\u670d\u52a1\u5668\u7684\u9ed8\u8ba4\u5b57\u7b26\u96c6\ncharacter_set_system\uff1a\u5b58\u50a8\u7cfb\u7edf\u5143\u6570\u636e\u7684\u5b57\u7b26\u96c6\uff0c\u603b\u662f utf8\uff0c\u4e0d\u9700\u8981\u8bbe\u7f6e\n")))}N.isMDXComponent=!0}}]);